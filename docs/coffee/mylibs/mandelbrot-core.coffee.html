<!DOCTYPE html><html><head><title>mandelbrot-core.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../coffee/mylibs/color-converter.coffee.html" class="source "><span class="base_path">coffee / mylibs / </span><span class="file_name">color-converter.coffee</span></a><a href="../../coffee/mylibs/mandelbrot-colors.coffee.html" class="source "><span class="base_path">coffee / mylibs / </span><span class="file_name">mandelbrot-colors.coffee</span></a><a href="../../coffee/mylibs/mandelbrot-core.coffee.html" class="source selected"><span class="base_path">coffee / mylibs / </span><span class="file_name">mandelbrot-core.coffee</span></a><a href="../../coffee/mylibs/mandelbrot-worker.coffee.html" class="source "><span class="base_path">coffee / mylibs / </span><span class="file_name">mandelbrot-worker.coffee</span></a><a href="../../coffee/mylibs/mandelbrot.coffee.html" class="source "><span class="base_path">coffee / mylibs / </span><span class="file_name">mandelbrot.coffee</span></a><a href="../../coffee/script.coffee.html" class="source "><span class="base_path">coffee / </span><span class="file_name">script.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>mandelbrot-core.coffee</h1><div class="filepath">coffee/mylibs/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nx">MandelbrotCore</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><h2>Constructor</h2>
</td><td class="code"><div class="highlight"><pre>  </pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Necessarily pretty basic as this class could be used in a webworker or a page</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@progressCallback) -&gt;</span>
  </pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><h2>Public Methods</h2>
</td><td class="code"><div class="highlight"><pre>  </pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><h3>getEscapeTimes</h3>

<p>Gets the escape time for every pixel</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getEscapeTimes: </span><span class="nf">(width, height, box, maxIterations) -&gt;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>We want an array of arrays</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">escapeTimes = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">height</span><span class="p">]</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Use the fat arrow to bind <code>this</code> to the loop function</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">do</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="nv">rowTimes = </span><span class="p">[]</span>
          <span class="k">for</span> <span class="nx">column</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">width</span><span class="p">]</span>
            <span class="nx">do</span> <span class="nf">(column) -&gt;</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Get the real and imaginary coordinates corresponding to this pixel</p>
</td><td class="code"><div class="highlight"><pre>              <span class="nv">real = </span><span class="nx">interpolate</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span>
              <span class="nv">imaginary = </span><span class="nx">interpolate</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">bottom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">height</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Calculate the escape time and store the result in our row</p>
</td><td class="code"><div class="highlight"><pre>              <span class="nx">rowTimes</span><span class="p">.</span><span class="nx">push</span> <span class="p">(</span><span class="nx">getEscapeTimeAtPoint</span> <span class="nx">real</span><span class="p">,</span> <span class="nx">imaginary</span><span class="p">,</span> <span class="nx">maxIterations</span><span class="p">)</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Store the result for this row</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">escapeTimes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">rowTimes</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>If a progress callback was provided use it to update caller on progress</p>
</td><td class="code"><div class="highlight"><pre>          <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">progressCallback</span><span class="o">?</span> <span class="k">then</span> <span class="k">this</span><span class="p">.</span><span class="nx">progressCallback</span> <span class="mi">100</span><span class="o">*</span><span class="nx">row</span><span class="o">/</span><span class="nx">height</span>
    <span class="k">return</span> <span class="nx">escapeTimes</span>
  </pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><h2>Private methods</h2>
</td><td class="code"><div class="highlight"><pre>  </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><h3>interpolate</h3>

<p>The linear interpolation function &#x2764;</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">interpolate = </span><span class="nf">(x, y0, y1, x0, x1) -&gt;</span> <span class="nx">y0</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">x0</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nx">y1</span> <span class="o">-</span> <span class="nx">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">x1</span><span class="o">-</span><span class="nx">x0</span><span class="p">))</span>
  </pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><h3>getEscapeTimeAtPoint</h3>

<p>Based on the algorithm on <a href="http://en.wikipedia.org/wiki/Mandelbrot_set#For_programmers">wikipedia</a></p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getEscapeTimeAtPoint = </span><span class="nf">(real, imaginary, maxIteration) -&gt;</span>
    <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">iteration</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">maxIteration</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">x</span><span class="o">*</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="o">*</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="mi">2</span>
        <span class="nv">xtemp = </span><span class="nx">x</span><span class="o">*</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">y</span><span class="o">*</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">real</span>
        <span class="nv">y = </span><span class="mi">2</span><span class="o">*</span><span class="nx">x</span><span class="o">*</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">imaginary</span>
        <span class="nv">x = </span><span class="nx">xtemp</span>
      <span class="k">else</span>
        <span class="k">break</span>
    <span class="k">return</span> <span class="nx">iteration</span>
    </pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Make the class globally available</p>
</td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="nx">self</span><span class="o">?</span> <span class="k">then</span> <span class="nv">self.MandelbrotCore = </span><span class="nx">MandelbrotCore</span>
<span class="k">else</span> <span class="k">if</span> <span class="nb">window</span><span class="o">?</span> <span class="k">then</span> <span class="nb">window</span><span class="p">.</span><span class="nv">MandelbrotCore = </span><span class="nx">MandelbrotCore</span>
<span class="k">else</span> <span class="k">throw</span> <span class="s">&quot;Could not make class global, expected either self or window to be defined.&quot;</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Tue Jun 19 2012 11:44:45 GMT+0100 (BST)  </div></div></body></html>